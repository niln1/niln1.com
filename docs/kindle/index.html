<!doctype html>
<html>
    <head>
    <meta charset="utf-8"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment-with-locales.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Orbitron&display=swap" rel="stylesheet">
    <style>
        #clock {
            font-size: 60px;
        }
        #date {
            font-size: 40px;
        }
        .center {
            margin: auto;
            width: 50%;
            text-align: center;
            padding: 10px;
        }
        .center-table {
            margin: auto;
            width: 90%;
            text-align: center;
            padding: 10px;
        }
        #table thead {
            font-size: 60px;
        }
        #table tbody {
            font-size: 40px;
        }
    </style>
    </head>
    <body>
        <div id="clock" class="center"></div>
        <div id="date" class="center"></div>
        <table id="table" class="center-table"></table>
        <script>
            var myVar = setInterval(function() {
                myTimer();
            }, 1000);

            function myTimer() {
            var date = moment().utcOffset(-7).format("ddd, MMM Do YYYY");
            var time = moment().utcOffset(-7).format("h:mm:ss a");
                document.getElementById("date").innerHTML = date;
                document.getElementById("clock").innerHTML = time;
            }
        </script>
        <script src="https://apis.google.com/js/api.js"></script>
        <script>
            var config = {
                color: {
                white: "#eeeeee",
                red: "#f05561",
                green: "#35b997",
                yellow: "#fee851",
                blue: "#1da2dc"
                },
                apiKey: "AIzaSyALKY26sNvyLTcprK5vnY7i27ZcxtIuhEA",
                discoveryDocs: 
                ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
                spreadsheetId: "14Dx9cHpwnVx2HK1LDTscnsVD-84pEMZ08q808puvl24"
            };

            window.lo = function (callback) {
                window.gapi.client.load("sheets", "v4", () => {
                    window.gapi.client.sheets.spreadsheets.values
                    .get({
                        spreadsheetId: config.spreadsheetId,
                        range: "Badge2021!A2:B"
                    })
                    .then(
                        response => {
                        const data = response.result.values;

                        const result = data.map(d => ({
                            "目标": d[0],
                            "记录": d[1],
                        })) || [];
                            
                        callback(result);
                        },
                        response => {
                        callback(false, response.result.error);
                        }
                    );
                });
            }

            window.haha = function () {
                window.gapi.client
                    .init({
                        apiKey: config.apiKey,
                        discoveryDocs: config.discoveryDocs
                    })
                    .then(() => {
                    lo(ol);
                });
            }

            window.ol = function (data, error) {
                if (data) {
                    console.log(data);
                    generateTableStart(data);
                } else {
                    console.log(error);
                }
            }

            window.generateTableStart = function (data) {
                function generateTableHead(table, data) {
                    let thead = table.createTHead();
                    let row = thead.insertRow();
                    for (let key of data) {
                        let th = document.createElement("th");
                        let text = document.createTextNode(key);
                        th.appendChild(text);
                        row.appendChild(th);
                    }
                }

                function generateTable(table, data) {
                    let tbody = table.createTBody();
                    for (let element of data) {
                        let row = tbody.insertRow();
                        for (key in element) {
                            let cell = row.insertCell();
                            let text = document.createTextNode(element[key]);
                            cell.appendChild(text);
                        }
                    }
                }

                let table = document.getElementById("table");
                let keys = Object.keys(data[0]);
                generateTableHead(table, keys);
                generateTable(table, data);
            }

            window.gapi.load("client", haha);

        </script>
    </body>
</html>
